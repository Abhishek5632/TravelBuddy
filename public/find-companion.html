<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Find Your Travel Companion | TravelBuddy</title>

  <style>
    * {margin: 0; padding: 0; box-sizing: border-box;}
    body {
      font-family: 'Poppins', sans-serif;
      background: #F4F9F9;
      color: #2D3436;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* ================= NAVBAR ================= */
    .navbar {
      background: rgba(255,255,255,0.95);
      backdrop-filter: blur(10px);
      position: fixed;
      top: 0;
      width: 100%;
      z-index: 1000;
      box-shadow: 0 2px 20px rgba(0,191,166,0.07);
    }
    .nav-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      height: 70px;
    }
    .nav-logo h2 {color:#00BFA6;font-size:1.7rem;font-weight:700;}
    .nav-menu {display:flex;list-style:none;gap:2rem;}
    .nav-menu li a {
      text-decoration: none;
      color: #2D3436;
      font-weight: 500;
      padding: 5px 0;
      transition: 0.3s;
    }
    .nav-menu li a:hover {color:#00BFA6;}

    .hamburger {display:none;flex-direction:column;cursor:pointer;}
    .hamburger span {width:25px;height:3px;background:#2D3436;margin:3px 0;border-radius:2px;}

    @media (max-width: 768px) {
      .nav-menu {
        position: fixed;
        top: 70px;
        left: -100%;
        flex-direction: column;
        background: white;
        width: 100%;
        padding: 2rem 0;
        gap: 1.4rem;
        transition: 0.3s;
      }
      .nav-menu.active {left: 0;}
      .hamburger {display:flex;}
    }


    /* ================= HERO ================= */
    .page-hero {
      background: linear-gradient(135deg,#00BFA6,#FDCB6E);
      padding: 130px 20px 70px;
      text-align: center;
      color: white;
    }
    .page-hero h1 {font-size:3rem;font-weight:700;margin-bottom:1rem;}


    /* ================= CONTENT ================= */
    .page-content {
      flex: 1;
      max-width:1200px;
      margin:0 auto;
      padding:50px 20px 70px;
      width: 100%;
    }

    .search-box {
      background:white;border-radius:14px;
      box-shadow:0 4px 16px rgba(0,0,0,0.10);
      padding:25px;
      display:flex;flex-wrap:wrap;justify-content:center;align-items:center;
      gap:20px;max-width:750px;margin:0 auto 30px;
    }
    .search-box input {
      padding:9px 14px;border:1px solid #ccc;border-radius:10px;font-size:15px;
      outline:none;transition:0.3s;
    }
    .search-box input:focus {border-color:#00BFA6;box-shadow:0 0 5px #00bfa644;}
    .search-box button {
      padding:9px 22px;border:none;border-radius:10px;
      background:linear-gradient(135deg,#00BFA6,#FDCB6E);
      color:white;cursor:pointer;font-weight:600;font-size:16px;
      transition:0.3s;
    }
    .search-box button:hover {transform:scale(1.05);}

    #resultsContainer {
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(270px,1fr));
      gap:22px;
      margin-top:20px;
    }

    /* ================= USER CARD ================= */
    .card {
      background:white;border-radius:14px;
      box-shadow:0 4px 12px rgba(0,0,0,0.09);
      overflow:hidden;transition:0.28s;
      display:flex;flex-direction:column;
    }
    .card:hover {transform:scale(1.03);}
    .card img {width:100%;height:175px;object-fit:cover;}

    .card-content {padding:17px 16px 14px;}
    .card-content h2 {color:#00BFA6;font-size:1.18rem;font-weight:700;}
    .card-content p {margin:4px 0;color:#444;font-size:0.95rem;}

    .view-btn {
      margin-top:10px;
      padding:8px 12px;
      border:none;
      border-radius:8px;
      background:linear-gradient(135deg,#00BFA6,#FDCB6E);
      color:white;
      font-weight:600;
      cursor:pointer;
      text-align:center;
      display:inline-block;
      transition:0.3s;
    }

    .view-btn:hover {transform:scale(1.05);}


    /* ================= FOOTER ================= */
    .footer {
      background:#2D3436;
      color:white;
      text-align:center;
      padding:2.5rem 20px;
    }

    #noResults {
      text-align:center;
      margin-top:20px;
      font-size:1.2rem;
      color:#00BFA6;
      font-weight:600;
      display:none;
    }

  </style>
</head>
<body>

  <!-- NAVBAR -->
  <nav class="navbar">
    <div class="nav-container">
      <div class="nav-logo"><h2>TravelBuddy</h2></div>

      <ul class="nav-menu">
        <li><a href="index.html">Home</a></li>
        <li><a href="find-companion.html">Find Companion</a></li>
        <li><a href="explore.html">Add Trip</a></li>
        <li><a href="profile.html">Profile</a></li>
      </ul>

      <div class="hamburger"><span></span><span></span><span></span></div>
    </div>
  </nav>

  <!-- HERO -->
  <section class="page-hero">
    <h1>Find Your Travel Companion</h1>
    <p>Connect with fellow travelers and make your journeys memorable!</p>
  </section>

  <!-- CONTENT -->
  <section class="page-content">

    <div class="search-box">
      <label>Date:</label>
      <input type="date" id="tripDate" />
      <label>Destination:</label>
      <input type="text" id="destination" placeholder="e.g. Jaipur, Goa" />
      <button onclick="searchTrips()">üîç Search</button>
    </div>

    <p id="noResults">No travelers found üòî</p>

    <div id="resultsContainer"></div>

  </section>

  <!-- FOOTER -->
  <footer class="footer">
    <h3>TravelBuddy</h3>
    <p>&copy; 2025 TravelBuddy. All rights reserved.</p>
  </footer>


<script>
/* Ensure user logged in */
const user = JSON.parse(localStorage.getItem("user"));
if (!user) {
  alert("Please log in first.");
  window.location.href = "signin.html";
}

/* Mobile Menu */
document.querySelector(".hamburger").onclick = () =>
  document.querySelector(".nav-menu").classList.toggle("active");

/* Backend URL */
const baseURL = window.location.hostname === "localhost"
  ? "http://localhost:5001"
  : "https://travelbuddy-hluu.onrender.com";

const container = document.getElementById("resultsContainer");
const noResults = document.getElementById("noResults");

/* Render Users */
function renderUsers(users) {
  let html = "";
  users.forEach(u => {
    const trip = u.trips?.[0] || { date:"N/A", destination:"Not Added" };
    const img = u.img || "https://cdn-icons-png.flaticon.com/512/1077/1077114.png";

    html += `
      <div class="card">
        <img src="${img}" alt="${u.firstName}">
        <div class="card-content">
          <h2>${u.firstName} ${u.lastName}</h2>
          <p><b>College:</b> ${u.college || "Not shared"}</p>
          <p><b>Date:</b> ${trip.date}</p>
          <p><b>Destination:</b> ${trip.destination}</p>

          <!-- ‚úî Correct page -->
          <a class="view-btn" href="companion-profile.html?email=${encodeURIComponent(u.email)}">
            View Profile
          </a>
        </div>
      </div>
    `;
  });

  container.innerHTML = html;
}

/* Load All Users On Page Load */
window.addEventListener("load", async () => {
  noResults.style.display = "block";
  noResults.textContent = "Loading travellers...";

  try {
    const res = await fetch(`${baseURL}/api/get-all-users`);
    const data = await res.json();

    if (data.success && data.users.length > 0) {
      noResults.style.display = "none";
      renderUsers(data.users);
    } else {
      noResults.style.display = "block";
      noResults.textContent = "No travelers found üòî";
    }

  } catch (err) {
    noResults.textContent = "Unable to connect to server.";
  }
});

/* Search Trips */
async function searchTrips() {
  const date = document.getElementById("tripDate").value;
  const destination = document.getElementById("destination").value.trim();

  if (!date || !destination) {
    alert("Please enter both fields.");
    return;
  }

  container.innerHTML = "";
  noResults.style.display = "none";

  try {
    const res = await fetch(`${baseURL}/api/find-users-by-trip`, {
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body: JSON.stringify({ date, destination })
    });

    const data = await res.json();

    if (data.success && data.users.length > 0) {
      renderUsers(data.users);
    } else {
      container.innerHTML = "";
      noResults.style.display = "block";
      noResults.textContent = "No travelers found üòî";
    }

  } catch (err) {
    noResults.style.display = "block";
    noResults.textContent = "Error reaching server.";
  }
}
</script>

</body>
</html>
